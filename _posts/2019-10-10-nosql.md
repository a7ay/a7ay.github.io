---
layout: posts
title:  "NoSQL" 
date:   2019-01-01 10:47:34 -0600
categories: nosql
---

Financial service providers are expected to available hundred percent of the time and expected to deliver up to date information. Expectations from a site like Ticketmaster are different, during peak hours site can make its users wait but when serving the information needs to be up to date. Social media sites are expected to be highly available but old data in the feed is tolerated. 

Relational databases like Oracle, MySQL, or Postgres can meet  expectations of consistency, availability and internal system failure tolerance by implementing  ACID principles. 

* Atomicity enables combining of multiple tasks which together complete an action into a single unit called transaction. Booking a seat also requires that a credit card be charged successfully.
* Consistency principle  ensures all tasks in a transaction are completed successfully. If one task from a set of tasks for a transaction fails, all successful changes are reverted and remaining abandoned. While this transaction is running no one else can make a contradicting change like double booking a seat. 
* While this seat is being booked the Isolation principle  ensures other visitors on the site see this seat as unavailable.
* The Durability principle will ensure completed transactions will be recorded even in the event of an external failure like network connectivity within the database subsystem. 

Consistency provided by an ACID databases comes at high cost and slow performance. The costs can get prohibitively large when the scale increases significantly. Facebook has close to 2 billion users.  NoSQL databases that tradeoff between consistency, Availability and failure tolerance can meet the needs at fraction of the cost.

NoSQL databases provide a simple, scalable, highly responsive, low cost and flexible option. Some of the biggest social network have invented and depend on NoSQL databases for their critical use cases.  NoSQL databases are built on distributed computing principles in which a  cluster of nodes act as one unit with data distributed across multiple nodes for scale. This adds the requirement of Partition tolerance to Consistency and Availability.  Collectively know as the CAP theorem introduced by Eric Brewer

* Consistency: What you write is available for reading to all clients
* Availability: All clients are able to read and write data continuously
* Partition tolerance: Cluster can handle partial failures. 

Consider two nodes on different ends of a partition. Writes to one will cause other node to become inconsistent. To maintain consistency you need to take one node down, loosing Availability. Only when the nodes are communicating you can preserve both consistency and availability but you forfeit Partition tolerance.  According to CAP theorem it is impossible to have all three traits simultaneously, databases have to pick 2 out of the 3 traits. ACID databases support Consistency and Availability and NoSQL databases are based on Consistency & Partition Tolerance (CP) or Availability & Partition Tolerance (AP).  

CP NoSQL databases maintain consistency of the data. MongoDB is a popular CP database that has a primary node for writing, and data is made available on other nodes for reading. If the primary node fails, the cluster makes the secondary node with most up to date data as the primary node. The cluster remains unavailable for writes during this transfer to maintain consistency of writes. Availability is forfeited for consistency. 

AP NoSQL stores accepts read and writes on multiple nodes and becomes eventually consistent by replication of changes across the cluster. Cassandra is an AP database. If a node goes down, clients continue to read data from a replicated node which may not have the most up to date data. Consistency is forfeited for Availability.

Choose NoSQL if you:    
Want to start fast,
need a flexible data model,
Scale at low cost,
Want low latency, and,  
Can tradeoff between consistency and availability


References:
* https://static.googleusercontent.com/media/research.google.com/en//archive/bigtable-osdi06.pdf
* https://www.ibm.com/cloud/learn/cap-theorem
* https://www.infoq.com/articles/cap-twelve-years-later-how-the-rules-have-changed/
