---
layout: posts
title:  "NoSQL" 
date:   2019-01-01 10:47:34 -0600
categories: nosql
---

Consider the scenario that you are designing a site for booking shows online. Simultaneous visitors on the site will be, viewing seats or purchasing tickets. Your responsibility is to present an accurate view of seat availability, prevent double booking and book seats reliabily. Additionally, the system must account for unexpected failures.

A relational database like Oracle, MySQL, or Postgres can meet these requirements easily. To  achieve the desired consistency and availability, relational databases follow ACID principles of: Atomicity, Consistency, Isolation, and Durability. Below is a brief introduction to these principles.

* Atomicity enables combining multiple tasks which together complete an action into a single unit called transaction. For instance, booking a seat also requires that a credit card is charged successfully. For the use case above this is a critical transaction.
* Consistency principle will ensure all tasks in a transaction are completed successfully. If a task in a transaction fails, the successful changes will be reverted and rest abandoned. While the transaction is running no one else can make a contradicting change like double booking a seat. 
* While this seat is being booked the Isolation principle will ensure other visitors on the site see this seat as unavailable.
* The Durability principle will ensure completed transactions will be recorded even in the event of an external failure like network connectivity within the database subsytem. 


Now if you look at the ticket booking site from an internal markets point of view, whose goal is to increase bookings This actor will have additional demands on the site; they would want to track every activity, show personalized offers or personalized experiences to fans visiting the site. If you look at the site from the support teams point of view they would want to keep track of all communications with ticker buyers. These use cases donâ€™t have the consistency or availability requirements of the seat booking component. NoSQL databases should be considered for use cases like these.

NoSQL databases provide a simple, scalable, highly responsive, low cost and flexible option. Some of the biggest social network have invented and depend on NoSQL databases for their critical use cases.  NoSQL databases are built on distributed computing principles in which a  cluster of nodes act as one unit with data distributed across multiple nodes for scale. This adds the requirement of Partition tolerance to Consistency and Availability.  Collectively know as the CAP theorem introduced by Eric Brewer

* Consistency:  what you write is available for reading to all clients
* Availability:  all clients are able to read and write data continuously
* Partition tolerance: cluster can handle node failures. 

Consider two nodes on different ends of a partition. Writes to one will cause other node to become inconsistent. To maintain consistency you need to take one node down, loosing Availability. Only when the nodes are communicating you can preserve both consistency and availability but you forfeit Partition tolerance.  According to CAP theorem it is impossible to have all three traits simultaneously, databases have to pick two out of the three traits. ACID databases support Consistency and Availability and NoSQL databases are based on Consistency & Partition Tolerance (CP) or Availability & Partition Tolerance (AP).  

CP NoSQL databases maintain consistency of the data. MongoDB is a popular CP database that has a primary node for writing, and data is made available on other nodes for reading. If the primary node fails, the cluster makes the secondary node with most up to date data as the primary node. The cluster remains unavailable for writes during this transfer to maintain consistency of writes. 

AP NoSQL stores accepts read and writes on multiple nodes and becomes eventually consistent by replication of changes across the cluster.  Even if a node goes down, clients can read data from a replicated node which may not have the most up to date data. Cassandra is an AP database. AP databases are most suitable for append only write.

Choose NoSQL if you:    
Want to start fast
need a flexible data model
Scale at low cost
Want low latency 
Can tradeoff between consistency and availability


References:
* https://static.googleusercontent.com/media/research.google.com/en//archive/bigtable-osdi06.pdf
* https://www.ibm.com/cloud/learn/cap-theorem
* https://www.infoq.com/articles/cap-twelve-years-later-how-the-rules-have-changed/
