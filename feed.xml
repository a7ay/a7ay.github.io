<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.1.0">Jekyll</generator><link href="/feed.xml" rel="self" type="application/atom+xml" /><link href="/" rel="alternate" type="text/html" /><updated>2020-12-13T00:40:46-06:00</updated><id>/feed.xml</id><title type="html">Tech Talk</title><subtitle>Welcome to Ajay Gupta's random musings about technology, books and photography.</subtitle><author><name>Ajay Gupta</name></author><entry><title type="html">Enterprise Integration Pattern, Async Messaging</title><link href="/messaging/2020/12/12/eip-messaging.html" rel="alternate" type="text/html" title="Enterprise Integration Pattern, Async Messaging" /><published>2020-12-12T10:47:34-06:00</published><updated>2020-12-12T10:47:34-06:00</updated><id>/messaging/2020/12/12/eip-messaging</id><content type="html" xml:base="/messaging/2020/12/12/eip-messaging.html">&lt;p&gt;Applications cannot exist in isolation. Your accounting application has links to documents managed by document service, receives data streams from your e-commerce application, and sends out notifications. The four common patterns of integration between Applications; shared databases, exchanging files, making remote calls, or messaging.&lt;/p&gt;

&lt;p&gt;A shared database pattern is used when integrating applications that are co-located.&lt;/p&gt;

&lt;p&gt;Exchanging data files is common among applications that move large amounts of data periodically. For instance, your application downloads a file of transactions nightly from your banks and add them to your balance sheet. Your applicationâ€™s logs are sent periodically to an application (like Splunk) that makes log analysis easier.&lt;/p&gt;

&lt;p&gt;Making remote calls is a widely adopted pattern. Establishing a point to point communication is quick to get off the ground and does not require a special toolchain. The simplest example is a REST service called by an HTTP client to perform a function. When you visit a movie site looking for what is playing near you, most likely a remote call-based system is fulfilling that request. Some of the largest commercial applications on the internet use this integration pattern. But it not without some of its drawbacks; lends to a tightly coupled system, services can evolve independently but the contracts may be locked. Many point to point connections make upgrades difficult. Newer applications need to speak the language of legacy systems that are part of the application. Application complexity increases if it needs to support guaranteed processing. The application needs to manage all the metadata describing the service, its location and connections.&lt;/p&gt;

&lt;p&gt;The final pattern of Async messaging is the most reliable way to integrate applications. Integrating applications send messages to each other which are processed asynchronously. Messaging technology has evolved to support both a large number of messages and provide sub-second response time usually expected from direct calls.&lt;/p&gt;

&lt;p&gt;A messaging system supports two patterns.&lt;/p&gt;

&lt;p&gt;Point-to-point messaging: The simplest messaging system has a point-to-point channel in which a publisher writes messages to an endpoint and the subscriber on the other end of the channel will retrieve the message for processing and share the response. To establish a point-to-point channel create a queue with two endpoints, one each for publishing and subscribing messages. Messages are processed in the order they arrive.&lt;/p&gt;

&lt;p&gt;Publish/subscribe: When multiple parties are interested in the same message then publish messages to a topic and every subscriber will receive a copy of the message. For instance, many applications may be interested in the price of a stock or the score of a game.&lt;/p&gt;

&lt;p&gt;Messaging systems provide additional capabilities that help scale integrations and simplify&lt;/p&gt;

&lt;p&gt;Message filters: Point to point channel architecture can cause an operational challenge through the explosion of channels. For instance, anytime a new type of message arrives channel needs to be established with all the subscribers. One way to combat this challenge is to use message filters. All messages are published to the same channel but the subscriber filters the messages they are interested in. New message types would not impact existing subscribers.&lt;/p&gt;

&lt;p&gt;Message router: Managing message filters spread across the network can be challenging, especially when you are making a change that affects multiple filters, a message router can help centralize this logic. All filtering logic lives in the message router, the router has a channel for inbound messages and multiple outbound channels. A subscriber would connect with the outbound channels.&lt;/p&gt;

&lt;p&gt;Message filters and router help manage point to point channels, but the language spoken by the different services in a system can present another challenge. A canonical data model adds a level of indirection between service formats. Message inside the pipeline flow in a standard model and consuming services covert message to their format. This responsibility can be given to another component of the message system, the message transformer.&lt;/p&gt;

&lt;p&gt;A message transformer (also know as adapters) transforms messages from the canonical data model to a service-specific format, like a spoken language interpreter. The canonical model of the application can change without affecting any of the services. This is especially helpful when connecting legacy service into a messaging channel&lt;/p&gt;

&lt;p&gt;To scale message processing a point of point channel can have multiple subscribers. Messages are delivered in a round-robin to the competing consumers. This may not work for all cases where message order is a requirement.&lt;/p&gt;

&lt;p&gt;A message broker is an architectural pattern that can bring all these capabilities together. A broker mediates communication between applications. It can be the central component that receives all messages, transforms them as necessary, and hands them over to a message router for delivering them to the right channel. A single instance of the broker operates in a hub and spoke model. All inbound messages arriving at the hub and distributed out to the subscribers. This model has a single point of failure and can be inefficient if the publisher and subscribers are geographically distributed. In such cases, a better approach may be to configure several message brokers, ideally one for each cluster of co-located subscribers. Subscribers depending on their needs can connect to the closest broker and un-processed messages travel from broker to broker. Multiple brokers can increase chattiness in the network with messages crisscrossing brokers, but a strategy of prioritizing local brokers over remote brokers can help curb it.&lt;/p&gt;

&lt;p&gt;Kafka is a distributed message broker that supports a publish/subscribe style of integration pattern. Kafka provides scale and reliability by operating on a cluster of machines. Producers and consumers are the basic types of users of the system. Producers write messages to topics that are divided into multiple partitions and the partitions are distributed across the cluster. Multiple copies of the same partitions are kept to improve the reliability of the system. This system of partitions also provides a scale where Kafka can be used as a stream processor like Samza and Apache storm.&lt;/p&gt;

&lt;p&gt;The cluster can be configured for high consistency or high availability. High consistency can be achieved by making sure each write was successfully replicated across multiple partitions. This may slow down the rate at which new messages can be written. Availability can be increased by managing the number of partitions, even if one machine goes down consumer will be redirected to other partitions. Apache zookeeper manages information about all the partitions and the role they play in the cluster.&lt;/p&gt;

&lt;p&gt;Reference:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://blog.redelastic.com/a-journey-into-reactive-streams-5ee2a9cd7e29#.2wqcc3cja&quot;&gt;Reactive streams&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://activemq.apache.org/how-do-distributed-queues-work.html&quot;&gt;ActiveMQ Topologies&lt;/a&gt;&lt;/p&gt;</content><author><name>Ajay Gupta</name></author><category term="messaging" /><summary type="html">Applications cannot exist in isolation. Your accounting application has links to documents managed by document service, receives data streams from your e-commerce application, and sends out notifications. The four common patterns of integration between Applications; shared databases, exchanging files, making remote calls, or messaging.</summary></entry><entry><title type="html">Affiliate Marketing</title><link href="/marketing/2020/12/01/affiliatemarketing.html" rel="alternate" type="text/html" title="Affiliate Marketing" /><published>2020-12-01T10:47:34-06:00</published><updated>2020-12-01T10:47:34-06:00</updated><id>/marketing/2020/12/01/affiliatemarketing</id><content type="html" xml:base="/marketing/2020/12/01/affiliatemarketing.html">&lt;p&gt;This year is the 20th anniversary of affiliate marketing, the industry is growing at a rapid pace and is concourse to hit 4.5 Billion by 2016. It all started after a conversation between a person with a blog and the CEO of Amazon. After the conversation, Jeff Bezos thought of an idea where Amazon would share revenue with publishers driving legitimate traffic toward Amazon and receive a part of the revenue in return. Some credit William Tobin, for the PC Flower Inc business he launched on Prodigy net, his company supported the tenant of affiliate marketing.&lt;/p&gt;

&lt;p&gt;Google indexes 50 billion pages and an average adult in the united states spends 5 hours online daily. Consumers are scattered all over the web in small communities, and as time spent online has surpassed TV watching. e-commerce merchants need a meaningful way to have conversations with consumers wherever they choose to spend their time. It is prohibitively expensive to reach each publisher and ask them to add a link back to your site. It is equally inefficient for publishers to spend time finding the best ads for their consumers amongst the various commerce sites. Affiliate marketing networks fill this void, they bring the content publishers &amp;amp; merchants together. The publisher can register their sites and receive a small piece of HTML that forms the portal for receiving relevant ads. Merchants can register the products they want to promote and the revenue they are willing to share. The top 3 marketplaces are Commission Junction, Linkshare, and Google affiliate network. Google is in the process of shutting down this business in favor of its search-based advertising. All the tracking &amp;amp; accounting is done by the affiliate network for smooth flow of commerce&lt;/p&gt;

&lt;p&gt;Some e-commerce sites go at it alone and manage an affiliate network themselves and take on the responsibility themselves Probably resulting in cost savings and higher revenue for the publishers. Ebay, Amazon are a few merchants that manage affiliates directly.&lt;/p&gt;

&lt;p&gt;There are downsides to using an affiliate network many small advertisers have found the hard way that traffic coming from many of these affiliate sites is theirs to being with, the most common case is where the user search for a coupon just before completing a purchase, fraudulent publishing sites advertise coupons for advertisers even though none exists, and in the search for coupons users end up on these sides which drop a cookie in consumers browser. Now if the consumer completes the transaction the referral credit will go to the affiliate publisher. Advertisers need to be careful and pay attention to where the traffic is coming from.&lt;/p&gt;

&lt;p&gt;In 2013 eBay sent FBI agents to 2 of its biggest affiliates claiming 20 million of revenue generated by these affiliates was fraudulent. These affiliates used a technique called â€˜cookie stuffingâ€™ These fraudsters gave away a browser widget that helped bloggers understand incoming traffic to their site. Every time the widget was invoked it clandestinely add an eBay cookie to the userâ€™s browser, and if the use made any purchase on eBay the credit would go to the publisher of the widgets. By the widget was removed it had spread to more than 650,000 computers.&lt;/p&gt;</content><author><name>Ajay Gupta</name></author><category term="marketing" /><summary type="html">This year is the 20th anniversary of affiliate marketing, the industry is growing at a rapid pace and is concourse to hit 4.5 Billion by 2016. It all started after a conversation between a person with a blog and the CEO of Amazon. After the conversation, Jeff Bezos thought of an idea where Amazon would share revenue with publishers driving legitimate traffic toward Amazon and receive a part of the revenue in return. Some credit William Tobin, for the PC Flower Inc business he launched on Prodigy net, his company supported the tenant of affiliate marketing.</summary></entry><entry><title type="html">NoSQL</title><link href="/nosql/2019/01/01/nosql.html" rel="alternate" type="text/html" title="NoSQL" /><published>2019-01-01T10:47:34-06:00</published><updated>2019-01-01T10:47:34-06:00</updated><id>/nosql/2019/01/01/nosql</id><content type="html" xml:base="/nosql/2019/01/01/nosql.html">&lt;p&gt;Consider the scenario that you are designing a site for booking shows online. Simultaneous visitors on the site will be, viewing seats or purchasing tickets. Your responsibility is to present an accurate view of seat availability, prevent double booking and book seats reliabily. Additionally, the system must account for unexpected failures.&lt;/p&gt;

&lt;p&gt;A relational database like Oracle, MySQL, or Postgres can meet these requirements easily. To  achieve the desired consistency and availability, relational databases follow ACID principles of: Atomicity, Consistency, Isolation, and Durability. Below is a brief introduction to these principles.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Atomicity enables combining multiple tasks which together complete an action into a single unit called transaction. For instance, booking a seat also requires that a credit card is charged successfully. For the use case above this is a critical transaction.&lt;/li&gt;
  &lt;li&gt;Consistency principle will ensure all tasks in a transaction are completed successfully. If a task in a transaction fails, the successful changes will be reverted and rest abandoned. While the transaction is running no one else can make a contradicting change like double booking a seat.&lt;/li&gt;
  &lt;li&gt;While this seat is being booked the Isolation principle will ensure other visitors on the site see this seat as unavailable.&lt;/li&gt;
  &lt;li&gt;The Durability principle will ensure completed transactions will be recorded even in the event of an external failure like network connectivity within the database subsytem.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Now if you look at the ticket booking site from an internal markets point of view, whose goal is to increase bookings This actor will have additional demands on the site; they would want to track every activity, show personalized offers or personalized experiences to fans visiting the site. If you look at the site from the support teams point of view they would want to keep track of all communications with ticker buyers. These use cases donâ€™t have the consistency or availability requirements of the seat booking component. NoSQL databases should be considered for use cases like these.&lt;/p&gt;

&lt;p&gt;NoSQL databases provide a simple, scalable, highly responsive, low cost and flexible option. Some of the biggest social network have invented and depend on NoSQL databases for their critical use cases.  NoSQL databases are built on distributed computing principles in which a  cluster of nodes act as one unit with data distributed across multiple nodes for scale. This adds the requirement of Partition tolerance to Consistency and Availability.  Collectively know as the CAP theorem introduced by Eric Brewer&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Consistency:  what you write is available for reading to all clients&lt;/li&gt;
  &lt;li&gt;Availability:  all clients are able to read and write data continuously&lt;/li&gt;
  &lt;li&gt;Partition tolerance: cluster can handle node failures.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Consider two nodes on different ends of a partition. Writes to one will cause other node to become inconsistent. To maintain consistency you need to take one node down, loosing Availability. Only when the nodes are communicating you can preserve both consistency and availability but you forfeit Partition tolerance.  According to CAP theorem it is impossible to have all three traits simultaneously, databases have to pick two out of the three traits. ACID databases support Consistency and Availability and NoSQL databases are based on Consistency &amp;amp; Partition Tolerance (CP) or Availability &amp;amp; Partition Tolerance (AP).&lt;/p&gt;

&lt;p&gt;CP NoSQL databases maintain consistency of the data. MongoDB is a popular CP database that has a primary node for writing, and data is made available on other nodes for reading. If the primary node fails, the cluster makes the secondary node with most up to date data as the primary node. The cluster remains unavailable for writes during this transfer to maintain consistency of writes.&lt;/p&gt;

&lt;p&gt;AP NoSQL stores accepts read and writes on multiple nodes and becomes eventually consistent by replication of changes across the cluster.  Even if a node goes down, clients can read data from a replicated node which may not have the most up to date data. Cassandra is an AP database. AP databases are most suitable for append only write.&lt;/p&gt;

&lt;p&gt;Choose NoSQL if you:  &lt;br /&gt;
Want to start fast
need a flexible data model
Scale at low cost
Want low latency 
Can tradeoff between consistency and availability&lt;/p&gt;

&lt;p&gt;References:&lt;/p&gt;

&lt;p&gt;https://static.googleusercontent.com/media/research.google.com/en//archive/bigtable-osdi06.pdf
https://www.ibm.com/cloud/learn/cap-theorem
https://www.infoq.com/articles/cap-twelve-years-later-how-the-rules-have-changed/&lt;/p&gt;</content><author><name>Ajay Gupta</name></author><category term="nosql" /><summary type="html">Consider the scenario that you are designing a site for booking shows online. Simultaneous visitors on the site will be, viewing seats or purchasing tickets. Your responsibility is to present an accurate view of seat availability, prevent double booking and book seats reliabily. Additionally, the system must account for unexpected failures.</summary></entry></feed>